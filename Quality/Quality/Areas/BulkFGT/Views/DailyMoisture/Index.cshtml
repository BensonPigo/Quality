@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/ThirdParty/plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="~/ThirdParty/SciCustom/css/TableStyle.css" rel="stylesheet" />
<script src="~/ThirdParty/plugins/DataTables/datatables.min.js"></script>
<link href="~/ThirdParty/plugins/jquery-ui/jquery-ui.css" rel="stylesheet" />

@model DatabaseObject.ViewModel.BulkFGT.DailyMoisture_ViewModel

<style type="text/css">
    .input-group {
        display: flex
    }

        .input-group > input:nth-child(1) {
            flex-grow: 3
        }

        .input-group > input:nth-child(2) {
            flex-grow: 2
        }

        .input-group > input:nth-child(3) {
            flex-grow: 1
        }

    .DetailTable > tbody > tr > td > input[type="text"] {
        width: 100%;
    }

    .row {
        --bs-gutter-x: 1.5rem;
        --bs-gutter-y: 0;
        display: flex;
        flex-wrap: wrap;
        margin-top: calc(var(--bs-gutter-y) * -1);
        margin-right: calc(var(--bs-gutter-x)/ -2);
        margin-left: calc(var(--bs-gutter-x)/ -2);
    }

    .button {
        background-color: #E00000; /* Red */
        border: none;
        color: white;
        padding: 6px 16px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
    }

    .row > * {
        flex-shrink: 0;
        width: 100%;
        max-width: 100%;
        padding-left: calc(var(--bs-gutter-x)/ 2);
    }

    .rowHeader {
        font-size: 1.1vw;
        font-weight: bold;
    }

    .queryHeader select {
        width: 10vw;
    }

    .rowHeader input[type="text"] {
        width: 10vw;
    }

    .col-auto {
        width: auto;
    }

        .col-auto > p {
            padding: 0
        }

    .White {
        color: white !important;
    }

    .Black {
        color: black !important;
    }

    .IsEditMode {
        color: white !important;
        cursor: pointer;
    }

    .IsEditModeQuery {
        color: gray !important;
        cursor: no-drop;
    }

    #ButtonMode {
        width: 92vw;
    }

    .DataTable {
        width: 100%;
        font-size: 1rem;
        font-weight: bold;
        border: solid 1px black;
        background-color: white;
    }

        .DataTable > tbody img {
            cursor: pointer;
        }

        .DataTable > tbody > tr:nth-of-type(odd) {
            background-color: #ffffff;
        }

        .DataTable > tbody > tr:nth-of-type(even) {
            background-color: #F0F2F2;
        }

        .DataTable > tbody > tr > td {
            border: solid 1px gray;
            padding: 0.5em;
            text-align: left;
            vertical-align: middle;
        }

        .DataTable input[type='text'], .DataTable input[type='number'] {
            width: 70%;
        }

    .bigSize {
        width: 3em;
        height: 2em;
    }

    #myCartons_info, #myEndlineMoisture_info, #myView_info {
        color: white
    }
    #myCartons_previous, #myCartons_next,
    #myEndlineMoisture_previous, #myEndlineMoisture_next,
    #myView_previous, #myView_next {
        color: white !important;
    }

    #myCartons_wrapper, #myCartons_wrapper > .dataTables_scrollHeadInner,
    #myEndlineMoisture_wrapper, #myEndlineMoisture_wrapper > .dataTables_scrollHeadInner,
    #myView_wrapper, #myView_wrapper > .dataTables_scrollHeadInner {
        width: 100%
    }
    #myEndlineMoisture_length > label > select {
        background-color: white;
    }
    .ui-widget-header {
        background-color: red;
        border: red;
    }
</style>

@using (Html.BeginForm("Index", ViewContext.RouteData.GetRequiredString("Controller"), new { }, FormMethod.Post, new { @id = "DetailForm" }))
{

    <div class="main-content">
        <header class="page-header">
            <div style="float:left">
                <h3>
                    <span>Daily Moisture Test</span>
                </h3>
                <div class="breadcrumb">
                    <div>Home</div>
                    <div class="current">Daily Moisture Test</div>
                </div>
            </div>
            <div class="breadcrumb queryHeader" style="justify-content: flex-end;">
                <h4 style="margin-right: 1em;color:white">Report No</h4>

                @Html.DropDownListFor(o => Model.Request.ReportNo, (List<SelectListItem>)Model.ReportNo_Source, new
                {
                    @value = Model.Request.ReportNo,
                    @onchange = "ReportNoChange(this.value)"
                })
                <input id="btnNew" type="button" class="button" style="margin-left:1em;border:0;cursor:pointer;" name="New" value="New">
            </div>
        </header>

        <div class="main-area">
            <div class="content-scroll">
                <div class="inner-scroll">
                    @*查詢列*@
                    <div class="row rowHeader">
                        <div class="col-auto">
                            <p class="InfoTitle White">Brand</p>
                        </div>
                        <div class="col-auto">
                            <input id="Request_BrandID" name="Request.BrandID" type="text" value="@Model.Request.BrandID">
                            <input id="btnBrandSelectItem" type="button" class="site-btn btn-blue" style="margin:0;border:0;" value="..." />
                        </div>
                        <div class="col-auto"><p class="InfoTitle White">Season</p></div>
                        <div class="col-auto">
                            <input id="Request_SeasonID" name="Request.SeasonID" type="text" value="@Model.Request.SeasonID">
                            <input id="btnSeasonSelectItem" type="button" class="site-btn btn-blue" style="margin:0;border:0;" value="..." />
                        </div>
                        <div class="col-auto"><p class="InfoTitle White">Style</p></div>
                        <div class="col-auto">
                            <input id="Request_StyleID" name="Request.StyleID" type="text" value="@Model.Request.StyleID">
                            <input id="btnStyleSelectItem" type="button" class="site-btn btn-blue" style="margin:0;border:0;" value="..." />
                        </div>
                        <div class="col-auto"><p class="InfoTitle White">SP#</p></div>
                        <div class="col-auto">
                            <input id="Request_OrderID" name="Request.OrderID" type="text" value="@Model.Request.OrderID">
                            @*<input id="btnArticleSelectItem" type="button" class="site-btn btn-blue" style="margin:0;border:0;" value="..." />*@
                        </div>

                        <div class="col-auto">
                            <button id="btnQuery" type="submit" name="Action:Query" class="site-btn btn-gy font1rem Black" style="padding: 0.4em;">Query</button>
                        </div>
                    </div>

                    @*按鈕列*@
                    <div style="margin-top: 1em;">
                        <table id="ButtonMode">
                            <tbody>
                                <tr>
                                    <td>
                                        <h4 id="Edit" style="margin-right: 1em;">
                                            <img src="~/Image/Icon/Edit.png" width="30" />
                                            Edit
                                        </h4>
                                    </td>
                                    <td>
                                        @*<button id="Save" type="submit" style="margin:0;min-width:0;background-color:transparent">
                                                <img src="~/Image/Icon/Save.png" width="30" />
                                                Save
                                            </button>*@

                                        <input id="SaveSubmit" type="submit" name="action:Edit" style="display:none" />
                                        <h4 id="Save" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/Save.png" width="30" />
                                            Save
                                        </h4>
                                    </td>
                                    <td>
                                        <h4 id="Undo" style="margin-right: 1em;">
                                            <img src="~/Image/Icon/Undo.png" width="30" />
                                            Undo
                                        </h4>
                                    </td>
                                    <td>
                                        <input id="DeleteSubmit" type="submit" name="action:Delete" style="display:none" />
                                        <h4 id="Delete" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/Delete.png" width="30" />
                                            Delete
                                        </h4>
                                    </td>
                                    <td>
                                        <input id="EncodeSubmit" type="submit" name="action:Encode" style="display:none" />
                                        <h4 id="Encode" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/Lock.png" width="30" />
                                            Encode
                                        </h4>
                                    </td>
                                    <td>
                                        <input id="AmendSubmit" type="submit" name="action:Amend" style="display:none" />
                                        <h4 id="Amend" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/Unlock.png" width="30" />
                                            Amend
                                        </h4>
                                    </td>
                                    <td>
                                        <h4 id="Excel" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/XLS.png" width="30" />
                                            Excel
                                        </h4>
                                    </td>
                                    <td>
                                        <h4 id="PDF" style="margin-right: 1em;">
                                            <img src="~/Image/Icon/PDF.png" width="30" />
                                            PDF
                                        </h4>
                                    </td>
                                    <td>
                                        <h4 id="SendMail" style="margin-right: 1em;">
                                            <img src="~/Image/Icon/SendMail.png" width="30" />
                                            Send to MR
                                        </h4>
                                    </td>
                                    @*<td>
                                        <h4 id="Picture" style=" margin-right: 1em;">
                                            <img src="~/Image/Icon/Camera.png" width="30" />
                                            Picture
                                        </h4>
                                    </td>*@
                                    <td style="width: 30%;">
                                    </td>
                                    <td align="right">
                                        <h4 id="New">
                                            <img src="~/Image/Icon/New.png" width="30" />
                                            New Item
                                        </h4>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*表頭*@
                    <div style="margin-top: 1em;">
                        <table class="DataTable">
                            <tbody>
                                <tr>
                                    <td><h5>Report No</h5></td>
                                    <td>
                                        <input id="ReportNo" name="ReportNo" readonly="readonly" type="text" value="@Model.Main.ReportNo">

                                        <input type="hidden" id="Main_ReportNo" name="Main.ReportNo" value="@Model.Main.ReportNo">
                                        <input type="hidden" id="Main_Status" name="Main.Status" value="@Model.Main.Status">
                                        <input type="hidden" id="Main_MRHandleEmail" name="Main.MRHandleEmail" value="@Model.Main.MRHandleEmail">
                                    </td>
                                    <td><h5>SP#</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.OrderID)
                                    </td>
                                    <td><h5>Brand</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.BrandID, new { @class = "Readonly" })
                                    </td>
                                </tr>
                                <tr>
                                    <td><h5>Season</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.SeasonID, new { @class = "Readonly" })
                                    </td>
                                    <td><h5>Style#</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.StyleID, new { @class = "Readonly" })
                                    </td>
                                    <td><h5>Report Date</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.ReportDateText, new { @class = "Readonly" })
                                    </td>
                                </tr>
                                <tr>
                                    <td><h5>Detection Instrument</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.Instrument, new { @maxlength = "15", @class = "OnlyEdit", @readonly = "readonly", @onclick = "open_EndlineMoistureDetail()" })
                                    </td>
                                    <td><h5>Fabrication</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.Fabrication, new { @maxlength = "15", @class = "Readonly" })
                                    </td>
                                    <td><h5>Line</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.Line, new { @maxlength = "15", @class = "OnlyEdit" })
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="6">
                                        <h5>Garment Moisture</h5>
                                    </td>
                                </tr>
                                <tr>
                                    <td><h5>Standard</h5></td>
                                    <td>
                                        <div class="input-group">
                                            @Html.TextBoxFor(o => o.Main.Standard, new { @maxlength = "15", @class = "Readonly" })
                                        </div>
                                    </td>
                                    <td colspan="4">
                                    </td>
                                </tr>
                                <tr>
                                    <td><h5>Result</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.Result, new { @class = "Readonly" })
                                    </td>
                                    <td><h5>Action</h5></td>
                                    <td>
                                        <select id="Main_Action" name="Main.Action" class="OnlyEdit" style="width: 18vw;">
                                            @foreach (var item in (List<SelectListItem>)Model.Action_Source)
                                            {
                                                string selected = item.Text.Equals(Model.Main.Action) ? "selected" : "";
                                                <option value="@item.Value" @selected>@item.Text</option>
                                            }
                                        </select>
                                    </td>
                                    <td><h5>Remark</h5></td>
                                    <td>
                                        @Html.TextBoxFor(o => o.Main.Remark, new { @maxlemhth = "300" , @class = "OnlyEdit" })
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*表身*@
                    <div style="margin-top: 1em; overflow:auto;">
                        <table cellspacing="100" class="DetailTable DataTable table table-striped display;" style="width: 200vw">
                            <thead>
                                <tr>

                                    <th><h4>Point 1</h4></th>
                                    <th><h4>Point 2</h4></th>
                                    <th><h4>Point 3</h4></th>
                                    <th><h4>Point 4</h4></th>
                                    <th><h4>Point 5</h4></th>
                                    <th><h4>Point 6</h4></th>
                                    <th><h4>Area</h4></th>
                                    <th><h4>Fabric</h4></th>
                                    <th><h4>Result</h4></th>
                                    <th><h4>Last Update</h4></th>
                                    <th style="width:5vw;"><h4></h4></th>
                                </tr>

                            </thead>
                            <tbody>

                                @for (int i = 0; i <= Model.Details.Count - 1; i++)
                                {
                                    string resultColor = Model.Details[i].Result == "Pass" ? "blue" : "red";
                                    string r = Model.Details[i].Result;
                                    <tr>
                                        <td>
                                            <input idx='@i' type='hidden' />
                                            @Html.HiddenFor(o => Model.Details[i].ReportNo)
                                            @Html.HiddenFor(o => Model.Details[i].Ukey)
                                            @Html.TextBoxFor(o => Model.Details[i].Point1, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(o => Model.Details[i].Point2, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(o => Model.Details[i].Point3, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(o => Model.Details[i].Point4, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(o => Model.Details[i].Point5, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(o => Model.Details[i].Point6, "", new { @class = "OnlyEdit", @step = "0.01", @style = "width:85%;", onchange = "value=QtyCheck(value)", @type = "number" })
                                        </td>




                                        <td>
                                            <select id="Details_@{@i}__Area" name="Details[@{@i}].Area">
                                                @foreach (var item in (List<SelectListItem>)Model.Area_Source)
                                                {
                                                    string selected = item.Text.Equals(Model.Details[i].Area) ? "selected" : "";
                                                    <option value="@item.Value" @selected>@item.Text</option>
                                                }
                                            </select>
                                        </td>

                                        <td>
                                            <select id="Details_@{@i}__Fabric" name="Details[@{@i}].Fabric" style="width:90%">
                                                @foreach (var item in (List<SelectListItem>)Model.Fabric_Source)
                                                {
                                                    string selected = item.Text.Equals(Model.Details[i].Fabric) ? "selected" : "";
                                                    <option value="@item.Value" @selected>@item.Text</option>
                                                }
                                            </select>
                                        </td>
                                        <td>
                                            @*@Html.TextBoxFor(o => Model.Details[i].Result, new { @class = $"{resultColor}", @readonly = "readonly" })*@
                                            @Html.TextBox($@"Details_{i}__Result", r, new { @class = $"{resultColor}", @readonly = "readonly" })
                                        </td>
                                        <td>
                                            @Html.DisplayFor(o => Model.Details[i].LastEditName, new { @class = "OnlyEdit" })
                                        </td>
                                        <td>
                                            <div style="width:100%;">
                                                <img class="detailDelete" src="~/Image/Icon/Delete.png" width="30" style="min-width:30px" />
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<div class="detail-dialog to-edit-detail-myEndlineMoisture" title="Detail">
    <div class="detail-dialog-content dialog-content-w-icon" style="height:70vh">
        <table cellspacing="100" id="myEndlineMoisture" class="table table-striped display">
            <thead>
                <tr class="row-name">
                    <th>Detection Instrument</th>
                    <th>Fabrication</th>
                    <th>Garment Moisture Standard</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.EndlineMoisture_Source.Count; i++)
                {
                    <tr class="row-content" style="vertical-align: middle; text-align: center;">
                        <td>
                            @Model.EndlineMoisture_Source[i].Instrument
                        </td>
                        <td>
                            @Model.EndlineMoisture_Source[i].Fabrication
                        </td>
                        <td>
                            @Model.EndlineMoisture_Source[i].Standard
                        </td>
                    </tr>
                }
            </tbody>

        </table>
        <br />
        <div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var msg;
    var EditMode;
    var EditType;
    var myEndlineMoistureTable;
    $(function () {
        msg = new MessagerAlert();
        EditMode = false;

        @Html.Raw(Model.ErrorMessage)

        IsEditModeChange();

        if (!$("body").hasClass("sidebar-collapse")) {
            $(".menu-trigger").click();
        }


        $(".detail-dialog").dialog({
            autoOpen: false,
            modal: true,
            closeText: ' ',
            width: 500,
            minHeight: 400,
            position: {
                my: "center top",
                at: "center top",
                of: window
            },
            dialogClass: "site-box",
            open: function (event, ui) {
                $('.ui-widget-overlay').bind('click', function () {
                    //location.reload();//強制Refresh頁面 Benson
                    $(".ui-dialog-content").dialog('close');
                });
                $(this).parent().siblings().find(".ui-dialog-content").dialog('close');

                //XX 藏起來
                $(".ui-dialog-titlebar-close").hide();
                $(".ui-dialog-title").css("width", "100%");
            },
            close: function () {
            },
        });

        // myEndlineMoisture
        myEndlineMoistureTable = $('#myEndlineMoisture').DataTable({
            "pageLength": 10,
            "autoWidth": false,
            "info": false,
            "filter": false,
            "paging": true,
            "info": false,
            "scrollY": "50vh",
            "scrollCollapse": true,
            columnDefs: [
                { targets: 0, width: "30%" },
                { targets: 1, width: "30%" },
                { targets: 2, width: "30%" },
            ]
        });

        //設定選擇
        $('#myEndlineMoisture tBody').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            }
            else {
                myEndlineMoistureTable.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
        });

        $(".to-edit-detail-myEndlineMoisture").dialog({
            width: "70%",
            dialogClass: "add-contact-box",
            buttons: {
                "1": {
                    text: 'Save',
                    click: function () {
                        var dataRow = myEndlineMoistureTable.row('.selected').data();

                        if (dataRow != undefined) {
                            //document.getElementById("Instrument").value = dataRow[0];
                            //document.getElementById("Fabrication").value = dataRow[1];
                            //document.getElementById("GarmentStandard").innerHTML = dataRow[2];

                            $("#Main_Instrument").val(dataRow[0]);
                            $("#Main_Fabrication").val(dataRow[1]);
                            $("#Main_Standard").val(dataRow[2]);

                            @*if (Instrument == "Aqua Boy") {
                                $("#CTNMoistureStandard").text(@ViewBag.FinalInspection_CTNMoistureStandard);
                            }
                            else if (Instrument == "B Machine") {
                                $("#CTNMoistureStandard").text(@ViewBag.FinalInspection_CTNMoistureStandardBM);
                            }
                            else {
                                Instrument = '';
                            }*@
                        }
                        else {
                            Instrument = '';
                            document.getElementById("Instrument").value = '';
                            document.getElementById("Fabrication").value = '';
                            document.getElementById("GarmentStandard").innerHTML = '';
                        }
                        //setColor();
                        $(this).dialog("close");
                    }
                    , "class": "button"
                    , "style": "bottom:0;background-color:#E00000"
                },
            },
        });

    });

    function IsEditModeChange() {
        EditModeButtionBind();
        Clear();
        $(".readonly").attr("disabled", "disabled");
        if (EditMode) {
            $(".queryHeader select").attr("disabled", "disabled");
            $('#btnNew').unbind('click').addClass("IsEditModeQuery");

            $(".rowHeader input[type='text']").attr("disabled", "disabled");
            $(".rowHeader input[type='button']").unbind('click').addClass("IsEditModeQuery");
            $('#btnQuery').addClass("IsEditModeQuery");

            $('#Edit ,#Delete ,#Encode, #Amend, #Excel, #PDF ,#SendMail').unbind('click').removeClass("IsEditMode");
            $('#Save, #Undo, #New, #Picture').bind('click').addClass("IsEditMode");

            $('.DetailTable input,.DetailTable select:not(.NotEdit)').removeAttr("disabled");

            if (EditType == "New") {
                $(".DataTable input:not(#ReportNo,#LastEditName,.Readonly), .DataTable select").removeAttr("disabled");
            }
            else {
                $(".OnlyEdit").removeAttr("disabled");
            }

            $(".DetailTable img").removeClass('display-None');

            DetailButtonBind();
            DetailDetailButtonBind();

            $('#btnQuery').on('click', function () {
                return false;
            });
        }
        else {
            $(".queryHeader select").removeAttr("disabled");
            $(".rowHeader input[type='text']").removeAttr("disabled");
            $(".rowHeader input[type='button']").removeClass("IsEditModeQuery");
            $('#btnNew').removeClass("IsEditModeQuery");
            $('#Save, #Undo, #New').unbind('click').removeClass("IsEditMode");
            $('#btnQuery').unbind('click').removeClass("IsEditModeQuery");

            QueryButtonBind();

            if ($('#ReportNo').val() != undefined && $('#ReportNo').val() != '') {
                $("#Edit, #Delete, #Picture ,#Excel ,#PDF, #SendMail").bind('click').addClass("IsEditMode");
            }
            else {
                $("#Edit, #Picture, #Delete ,#Excel ,#PDF, #SendMail").unbind('click').removeClass("IsEditMode");
            }

            if ($('#Main_Status').val() == "New" || $('#Main_Status').val() == "") {
                $('#Encode').bind('click').addClass("IsEditMode");
                $('#Amend').unbind('click').removeClass("IsEditMode");
            }
            if ($('#Main_Status').val() == "Confirmed") {
                $('#Amend').bind('click').addClass("IsEditMode");
                $('#Encode ,#Edit ,#Delete').unbind('click').removeClass("IsEditMode");
            }

            if ($('#Main_ReportNo').val() == '') {
                $('#Encode').unbind('click').removeClass("IsEditMode");
            }

            $(".DataTable input, .DataTable select").attr("disabled", "disabled");
            $('.DetailTable input,.DetailTable select').attr("disabled");
            $(".DetailTable img").addClass('display-None');


            $('#btnQuery').on('click', function () {
                if (EditType != "New") {
                    if (($('#Request_BrandID').val() == '' || $('#Request_SeasonID').val() == '' || $('#Request_StyleID').val() == '') && $('#Request_OrderID').val() == '') {
                        msg.WithError("<Style, Brand and Season> or SP# cannot be empty");
                        return false;
                    }
                }
            });
        }

    }

    function Clear() {
        if (EditType == "New") {
            $(".DataTable input[type='text'], .DataTable input[type='number'], .DataTable select").val('');
            $('#Result').html('');
        }
    }

    function ReportNoChange(value) {
        $('#btnQuery').unbind('click').click();
    }

    function QueryButtonBind() {
        $('#btnBrandSelectItem').on('click', function () {
            var para = "?TargetID=Request_BrandID";
            window.open('@Url.Action("BrandList","PublicWindow",new{Area=""})' + para, 'Brand', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('#btnSeasonSelectItem').on('click', function () {
            var para = "?TargetID=Request_SeasonID&BrandID=" + $('#Request_BrandID').val();
            window.open('@Url.Action("SeasonList","PublicWindow",new{Area=""})' + para, 'Season', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('#btnStyleSelectItem').on('click', function () {
            var para = "?TargetID=Request_StyleID&BrandID=" + $('#Request_BrandID').val() + "&SeasonID=" + $('#Request_SeasonID').val();
            window.open('@Url.Action("StyleList","PublicWindow",new{Area=""})' + para, 'Style', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        @*$('#btnArticleSelectItem').on('click', function () {
            if ($('#Request_BrandID').val() == '' || $('#Request_SeasonID').val() == '' || $('#Request_StyleID').val() == '') {
                msg.WithError('Please input style, brand and season before choose article.');
                return;
            }

            var para = "?TargetID=Request_Article&OrderID=&StyleUkey=0&BrandID=" + $('#Request_BrandID').val() + "&SeasonID=" + $('#Request_SeasonID').val() + "&StyleID=" + $('#Request_StyleID').val();
            window.open('@Url.Action("ArticleList","PublicWindow",new{Area=""})' + para, 'Article', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });*@


        blurEvent('Request_');
    }

    function blurEvent(name) {

        $("#Main_OrderID").unbind('blur').blur(function () {
            if ($(this).val() == '') {
                return;
            }

            $.ajax({
                url: "@Url.Action("SPBlur", new{Area= "BulkFGT" })",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ OrderID: $(this).val(), ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data.ErrMsg != "") {
                        $("#Main_OrderID").val('');
                        msg.WithError(data.ErrMsg);
                    }
                    else {
                        if (data.BrandID != "") {
                            $('#Main_BrandID').val(data.BrandID);
                        }

                        if (data.SeasonID != "") {
                            $('#Main_SeasonID').val(data.SeasonID);
                        }

                        if (data.StyleID != "") {
                            $('#Main_StyleID').val(data.StyleID);
                        }

                        //if (data.OrderID != "") {
                        //    $('#Main_OrderID').val(data.OrderID);
                        //}

                        //if (data.Teamwear == true) {
                        //    $('#Main_IsTeamwear').attr('checked', 'checked');
                        //}
                        //else {
                        //    $('#Main_IsTeamwear').removeAttr('checked');
                        //}
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        $("#" + name + "BrandID").blur(function () {
            if ($(this).val() == '') {
                if (name == '') {
                    ClearColor();
                }

                return;
            }

            $.ajax({
                url: "@Url.Action("BrandList","PublicWindow",new{Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ BrandID: $(this).val(), ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data.length == 0) {
                        $("#" + name + "BrandID").val('');
                        msg.WithError('Brand Not Found');
                    }

                    ReportNoClear(name);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        $("#" + name + "SeasonID").blur(function () {
            if ($(this).val() == '') {
                if (name == '') {
                }

                return;
            }


            var BrandID = $('#' + name + 'BrandID').val();
            $.ajax({
                url: "@Url.Action("SeasonList","PublicWindow",new{Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ BrandID: BrandID, SeasonID: $(this).val(), ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data.length == 0) {
                        $("#" + name + "SeasonID").val('');
                        msg.WithError('Season Not Found');
                    }

                    ReportNoClear(name);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        $("#" + name + "StyleID").blur(function () {
            if ($(this).val() == '') {

                if (name == '') {
                }

                return;
            }


            var BrandID = $('#' + name + 'BrandID').val();
            var SeasonID = $('#' + name + 'SeasonID').val();
            $.ajax({
                url: "@Url.Action("StyleList","PublicWindow",new{Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ BrandID: BrandID, SeasonID: SeasonID, StyleID: $(this).val(), ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data.length == 0) {
                        $("#" + name + "StyleID").val('');
                        msg.WithError('Style Not Found');
                    }

                    ReportNoClear(name);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        @*$('#' + name + 'Article').blur(function () {
            if ($(this).val() == '') {
                return;
            }

            var BrandID = $('#' + name + 'BrandID').val();
            var SeasonID = $('#' + name + 'SeasonID').val();
            var StyleID = $('#' + name + 'StyleID').val();

            $.ajax({
                url: "@Url.Action("ArticleList","PublicWindow",new{Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ BrandID: BrandID, StyleUkey: 0, SeasonID: SeasonID, StyleID: StyleID, Article: $(this).val(), ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data.length == 0) {
                        $("#" + name + "Article").val('');
                        msg.WithError('Article Not Found');
                    }

                    ReportNoClear(name);
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });*@
    }


    function open_EndlineMoistureDetail() {
        $(".to-edit-detail-myEndlineMoisture").dialog("open");
        $("#myEndlineMoisture").DataTable().columns.adjust();
    }

    function EditModeButtionBind() {
        $('#Edit').on('click', function () {
            if ($('#ReportNo').val() != null && $('#ReportNo').val() != "") {
                EditMode = true;
                EditType = "";
                $("#SaveSubmit").attr("name", "Action:Edit");
                IsEditModeChange();
            }
        });

        $('#btnNew').on('click', function () {
            EditMode = true;
            EditType = "New";
            $("#SaveSubmit").attr("name", "Action:New");
            $("#Main_TestBeforePicture").val('');
            $("#Main_TestAfterPicture").val('');
            IsEditModeChange();

            $('.DetailTable > tbody > tr').each(function () {
                $(this).remove();
            });

        });

        $('#New').unbind('click').on('click', function () {
            if (!EditMode) {
                return;
            }
            AddDetailRow();
        });

        $('#Save').on('click', function (e) {
            if (EditMode == false) {
                return false;
            }

            var detail = [];
            var ErrMsg = "";

            if ($('#Main_OrderID').val() == '' || $('#Main_OrderID').val() == undefined) {
                ErrMsg += "SP# cannot be empty<br/>";
            }

            if ($('#Main_Instrument').val() == '' || $('#Main_Instrument').val() == undefined) {
                ErrMsg += "Detection Instrument cannot be empty<br/>";
            }

            if (ErrMsg != "") {
                msg.WithError(ErrMsg);
                return false;
            }

            // 重新調整index 順序。
            $('.DetailTable > tbody > tr').each(function (index, data) {
                var idx = $(this).closest('tr').attr('idx');
                if (idx != index) {
                    $.each($(this).find("input[id^='Details']"), function () {
                        var tableName = $(this).attr('name').substr(0, $(this).attr('name').indexOf("["));
                        var rollName = $(this).attr('name').substr($(this).attr('name').indexOf("]") + 2, $(this).attr('name').length - $(this).attr('name').indexOf("]"));
                        $(this).attr("id", tableName + "_" + index.toString() + "__" + rollName);
                        $(this).attr("name", tableName + "[" + index.toString() + "]." + rollName);
                    });

                    $.each($(this).find("select[id^='Details']"), function () {
                        var tableName = $(this).attr('name').substr(0, $(this).attr('name').indexOf("["));
                        var rollName = $(this).attr('name').substr($(this).attr('name').indexOf("]") + 2, $(this).attr('name').length - $(this).attr('name').indexOf("]"));
                        $(this).attr("id", tableName + "_" + index.toString() + "__" + rollName);
                        $(this).attr("name", tableName + "[" + index.toString() + "]." + rollName);
                    });
                }
            });

            $(".rowHeader input[type='text']").removeAttr("disabled");
            $(".DataTable input, .DataTable select").removeAttr("disabled");

            $("#SaveSubmit").click();
        });

        $('#Undo').on('click', function () {
            EditMode = false;
            IsEditModeChange();
            if (EditType != "New") {
                $('#btnQuery').unbind('click').click();
            }
            else {
                if ($('#Request_BrandID').val() != '' || $('#Request_SeasonID').val() != '' || $('#Request_StyleID').val() != '' || $('#Request_OrderID').val() != '') {
                    $('#btnQuery').unbind('click').click();
                }
            }

            EditType = "";
        });

        $('#Delete').on('click', function (e) {
            if (EditMode == false && $('#ReportNo').val() != null && $('#ReportNo').val() != "") {
                e.preventDefault();
                msg.WithConfirm('Do you want to delete the data ?',
                    function () {
                        $("#DeleteSubmit").click();
                    }, null);
            }
        });

        $('#Encode').on('click', function (e) {
            if (EditMode == false && $('#ReportNo').val() != null && $('#ReportNo').val() != "") {
                e.preventDefault();
                msg.WithConfirm('Do you want to Encode the data ?',
                    function () {
                        $("#EncodeSubmit").click();
                    }, null);
            }
        });

        $('#Amend').on('click', function (e) {
            if (EditMode == false && $('#ReportNo').val() != null && $('#ReportNo').val() != "") {
                e.preventDefault();
                msg.WithConfirm('Do you want to Amend the data ?',
                    function () {
                        $("#AmendSubmit").click();
                    }, null);
            }
        });

        $('#Picture').on('click', function () {
            var para = "?Title=" + $('.page-header span').html() + "&EditMode=" + EditMode;
            para += "&" + "Table=DailyMoisture";
            para += "&" + "TargetBeforeColumn=Main_TestBeforePicture";
            para += "&" + "TargetAfterColumn=Main_TestAfterPicture";
            para += "&" + "BeforeColumn=TestBeforePicture";
            para += "&" + "AfterColumn=TestAfterPicture";
            para += "&" + "PKey_1=ReportNo";
            para += "&" + "PKey_1_Val=" + $('#ReportNo').val();
            window.open('@Url.Action("PictureList", "PublicWindow",new { Area=""})' + para, 'Picture List', config = 'toolbar=no,status=no,location=no,width=1024,height=750');
        });

        $('#PDF').on('click', function () {
            if ($('#ReportNo').val() == "") {
                return false;
            }

            ToReport(1);
        });

        $('#Excel').on('click', function () {
            if ($('#ReportNo').val() == "") {
                return false;
            }

            ToReport(0);
        });


        $('#SendMail').on('click', function () {

            var para = '';
            window.open('@Url.Action("SendMailer", "SendMailAttachfiles", new { Area=""})' + para, 'SendMail', config = 'toolbar=no,status=no,location=no,width=800,height=400');

        });
    }

    function DetailButtonBind() {
        $('#btnDetailBrandSelectItem').on('click', function () {
            var para = "?TargetID=BrandID";
            window.open('@Url.Action("BrandList","PublicWindow",new{Area=""})' + para, 'BrandID', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('#btnDetailSeasonSelectItem').on('click', function () {
            var para = "?TargetID=SeasonID&BrandID=" + $('#BrandID').val();
            window.open('@Url.Action("SeasonList","PublicWindow",new{Area=""})' + para, 'SeasonID', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('#btnDetailStyleSelectItem').on('click', function () {
            var para = "?TargetID=StyleID&BrandID=" + $('#BrandID').val() + "&SeasonID=" + $('#SeasonID').val();
            window.open('@Url.Action("StyleList","PublicWindow",new{Area=""})' + para, 'StyleID', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        @*$('#btnDetailArticleSelectItem').on('click', function () {
            var para = "?TargetID=Article&OrderID=&StyleUkey=0&BrandID=" + $('#BrandID').val() + "&SeasonID=" + $('#SeasonID').val() + "&StyleID=" + $('#StyleID').val();
            window.open('@Url.Action("ArticleList","PublicWindow",new{Area=""})' + para, 'Article', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });*@

        $('#btnDetailSubconNameSelectItem').on('click', function () {
            window.open('@Url.Action("LocalSuppList","PublicWindow",new{Area=""})', 'T1/SubconName', config = 'toolbar=no,status=no,location=no,width=900,height=650');
        });

        $('#btnDetailSupplierNameSelectItem').on('click', function () {
            window.open('@Url.Action("TPESuppList","PublicWindow",new{Area=""})', 'T2/SupplierName', config = 'toolbar=no,status=no,location=no,width=800,height=650');
        });

        $('#btnDetailTechnicianSelectItem').on('click', function () {
            var para = "?CallFunction=MockupOven";
            window.open('@Url.Action("TechnicianList", "PublicWindow",new{Area=""})' + para, 'Technician', config = 'toolbar=no,status=no,location=no,width=800,height=650');
        });

        $('#btnDetailMRSelectItem').on('click', function () {
            window.open('@Url.Action("Pass1List", "PublicWindow",new{Area=""})', 'MR', config = 'toolbar=no,status=no,location=no,width=800,height=650');
        });

        blurEvent("");
    }

    function ClearColor() {
        $('.AFColor').each(function () {
            $(this).val('');
        });
    }

    function DetailDetailButtonBind() {
        $('.btnArtworkColorItem').on('click', function () {
            var brandid = $('#BrandID').val();
            if (brandid == '') {
                msg.WithError('Brand is null');
                return;
            }

            var idx = $(this).attr("idv");
            var para = "?TargetID=" + idx + "__ArtworkColor&BrandID=" + brandid + "&Title=Artwork Color";
            window.open('@Url.Action("ColorList", "PublicWindow",new{Area=""})' + para, 'Artwork Color', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('.btnFabricColorItem').on('click', function () {
            var brandid = $('#BrandID').val();
            if (brandid == '') {
                msg.WithError('Brand is null');
                return;
            }

            var idx = $(this).attr("idv");
            var para = "?TargetID=" + idx + "__FabricColor&BrandID=" + brandid + "&Title=Fabric Color";
            window.open('@Url.Action("ColorList", "PublicWindow",new{Area=""})' + para, 'Fabric Color', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('.detailDelete').unbind('click').on('click', function () {
            var t = $(this);

            msg.WithConfirm('Do you want to delete the data ?',
                function () {
                    t.parents().parents('tr').remove();
                    msg.WithSuccess("Delete Success");
                }, null);
        });

        $('.btnRefnoSelectItem').on('click', function () {
            var targetID = $(this).attr("targetID");
            var OrderID = $("#Main_OrderID").val();
            if (OrderID == '') {
                msg.WithError('Please input SP#.');
                return;
            }
            var para = `?TargetID=${targetID}&OrderID=${OrderID}`;
            window.open('@Url.Action("Po_Supp_Detail_RefnoList", "PublicWindow",new{Area=""})' + para, 'Style', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('.FabricRefNoTxt').unbind('blur').blur(function () {
            var targetID = $(this).attr("ID");
            var orderID = $('#Main_OrderID').val();
            var refno = $(this).val();
            if (refno == '') {
                return;
            }
            if (orderID == '') {
                $(this).val('');
                msg.WithError('Please input SP#.');
                return;
            }
            $.ajax({
                url: "@Url.Action("Po_Supp_Detail_RefnoList", "PublicWindow",new { Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ OrderID: orderID, Refno: refno , TargetID: targetID, ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data == '') {
                        $(`#${targetID}`).val('');
                        msg.WithError('Refno Not Found');
                    }
                    else {
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        $('.btnRefnoSelectItem').on('click', function () {
            var targetID = $(this).attr("targetID");
            var OrderID = $("#Main_OrderID").val();
            if (OrderID == '') {
                msg.WithError('Please input SP#.');
                return;
            }
            var para = `?TargetID=${targetID}&OrderID=${OrderID}`;
            window.open('@Url.Action("Po_Supp_Detail_RefnoList", "PublicWindow",new{Area=""})' + para, 'Style', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

        $('.HTRefNoTxt').unbind('blur').blur(function () {
            var targetID = $(this).attr("ID");
            var orderID = $('#Main_OrderID').val();
            var refno = $(this).val();
            if (refno == '') {
                return;
            }
            if (orderID == '') {
                $(this).val('');
                msg.WithError('Please input SP#.');
                return;
            }
            $.ajax({
                url: "@Url.Action("Po_Supp_Detail_RefnoList", "PublicWindow",new { Area=""})",
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ OrderID: orderID, Refno: refno, MtlTypeID: 'HEAT TRANS', TargetID: targetID, ReturnType: "JSON" }),
                async: true,
                success: function (data) {
                    if (data == '') {
                        $(`#${targetID}`).val('');
                        msg.WithError('Refno Not Found');
                    }
                    else {
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(xhr.responseText);
                }
            });
        });

        $('.btnHTRefNoSelectItem').on('click', function () {
            var targetID = $(this).attr("targetID");
            var OrderID = $("#Main_OrderID").val();
            if (OrderID == '') {
                msg.WithError('Please input SP#.');
                return;
            }
            var para = `?TargetID=${targetID}&OrderID=${OrderID}&MtlTypeID=HEAT TRANS`;
            window.open('@Url.Action("Po_Supp_Detail_RefnoList", "PublicWindow",new{Area=""})' + para, 'Style', config = 'toolbar=no,status=no,location=no,width=400,height=650');
        });

    }

    function GetBrandList(data, targetID) {
        $('#' + targetID).val(data);

        ClearColor();
        ReportNoClear(targetID);
    }

    function GetSeasonList(data, targetID) {
        $('#' + targetID).val(data);

        ReportNoClear(targetID);
    }

    function GetStyleList(data, targetID) {
        $('#' + targetID).val(data);

        ReportNoClear(targetID);
    }

    //function GetArticleList(data, targetID) {
    //    $('#' + targetID).val(data);
    //    ReportNoClear(targetID);
    //}

    function GetPo_Supp_Detail_Refno(data, targetID) {
        $('#' + targetID).val(data );
    }

    function ReportNoClear(targetID) {
        if (targetID.indexOf('Request_') > -1) {
            $('#Request_ReportNo').html('');
        }
    }

    function GetLocalSupp(data) {
        $('#T1Subcon').val(data.ID);
        $('#T1SubconAbb').val(data.Name);
    }

    function GetTPESupp(data) {
        $('#T2Supplier').val(data.ID);
        $('#T2SupplierAbb').val(data.Name);
    }

    function GetTechnician(data) {
        $('#Technician').val(data.ID);
        $('#TechnicianDesc').val(data.Name + " Ext. " + data.ExtNo);
    }

    function GetPass1(data) {
        $('#MR').val(data.ID);
        $('#MRDesc').val(data.Name + " Ext. " + data.ExtNo);
        $('#MRMail').val(data.EMail);
    }

    function GetColor(pickList, targetID) {
        var id = [];
        var name = [];
        $.each(pickList, function (idx, obj) {
            id.push(obj.ID);
            name.push(obj.Name);
        });

        $('#MockupOven_Detail_' + targetID ).val(id.join(';'));
        $('#MockupOven_Detail_' + targetID + 'Name').val(name.join(';'));
    }

    function selectChange(obj) {
        var result = $(obj).val();
        if (result == "Pass") {
            $(obj).removeClass('red').addClass('blue');
        }
        else {
            $(obj).removeClass('blue').addClass('red');
        }

        var key = $(obj).parents('td').parents('tr').children('td').find("input[type='hidden']").attr('idx');

        var resultChange = document.getElementById("MockupOven_Detail_" + key + "__ResultChange").value;
        var resultStain = document.getElementById("MockupOven_Detail_" + key + "__ResultStain").value;

        if (resultChange == "Fail" || resultStain == "Fail") {
            document.getElementById("MockupOven_Detail_" + key + "__Result").value = 'Fail';
        }
        else {
            document.getElementById("MockupOven_Detail_" + key + "__Result").value = 'Pass';
        }

        $("#MockupOven_Detail_" + key + "__Result").removeClass("blue").removeClass("red");;
        var detailResultColor = document.getElementById("MockupOven_Detail_" + key + "__Result").value == "Pass" ? "blue" : "red";
        $("#MockupOven_Detail_" + key + "__Result").addClass(detailResultColor);

    }

    function AddDetailRow() {
        var BrandID = $('#BrandID').val();
        var SeasonID = $('#SeasonID').val();
        var StyleID = $('#StyleID').val();

        var lastNO;
        if ($('.DetailTable > tbody > tr').length > 0) {
            lastNO = parseInt($('.DetailTable > tbody > tr:last-child > td > input[type="hidden"] ').attr('idx')) + 1;
        }
        else {
            lastNO = 0;
        }

        $.ajax({
            url: "@Url.Action("AddDetailRow", new { Area = "BulkFGT" })",
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ lastNO: lastNO, BrandID: BrandID, SeasonID: SeasonID, StyleID: StyleID }),
            async: false,
            success: function (data) {
                $('.DetailTable > tbody').append(data);
                DetailDetailButtonBind();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(xhr.responseText);
            }
        });
    }

    function GetPicture(data) {
        $('#Main_TestBeforePicture').val(data.BeforePicture.replace("data:image/png;base64,", ""));
        $('#Main_TestAfterPicture').val(data.AfterPicture.replace("data:image/png;base64,", ""));
    }

    function FailMail() {
        var para = "?Title=" + $('.page-header span').html() + "&FactoryID=@ViewBag.FactoryID&Type=BulkFGT&ExitReload=False";
        window.open('@Url.Action("TestFailMailList", "PublicWindow",new { Area=""})' + para, 'Mail List', config = 'toolbar=no,status=no,location=no,width=650,height=750');
    }

    function GetTestFailMailList(data) {
        var to = "";
        var cc = "";
        $.each(data, function (index, value) {
            to += value.To + ';';
            cc += value.CC + ';';
        });

        $.ajax({
            url: "@Url.Action("SendMail")",
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ ReportNo: $('#ReportNo').val(), TO: to, CC: cc }),
            async: false,
            success: function (data) {
                if (data.result) {
                    msg.WithSuccess("Success");
                }
                else {
                    msg.WithWarning(data.resultMsg);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                // console.log(xhr.responseText);
                msg.WithWarningCheck(xhr.responseText, function () {
                    location.reload();
                });
            }
        });
    }

    function GetSendMailer(data) {
        var to = data.To;
        var cc = data.CC;

        if (to != "") {

        $.ajax({
            url: "@Url.Action("SendMail")",
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ ReportNo: '@Model.Main.ReportNo', TO: to, CC: cc }),
            async: false,
            success: function (data) {
                if (data.result) {
                    msg.WithSuccesCheck("Success", function () {
                    });
                }
                else {
                    msg.WithWarningCheck(data.resultMsg, function () {
                        location.reload();
                    });
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                // console.log(xhr.responseText);
                msg.WithWarningCheck(xhr.responseText, function () {
                    location.reload();
                });
            }
        });
        }
    }

    function ToReport(IsToPDF) {
        $.ajax({
            url: "@Url.Action("Report", new { Area = "BulkFGT" })",
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ ReportNo: $('#ReportNo').val(), IsToPDF: IsToPDF }),
            async: false,
            success: function (data) {
                if (data.Result) {
                    window.location.href = data.reportPath;
                }
                else {
                    msg.WithError(data.ErrorMessage);
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(xhr.responseText);
            }
        });
    }


    function QtyCheck(value) {
        return Number.parseFloat(value).toFixed(2);
    }
</script>