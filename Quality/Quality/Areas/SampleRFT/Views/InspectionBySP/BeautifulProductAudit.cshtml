@model DatabaseObject.ViewModel.SampleRFT.InspectionBySP_BA

@{
    Layout = "~/Areas/SampleRFT/Views/Shared/_ForAll_Layout.cshtml";
}

<link href="~/ThirdParty/plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="~/ThirdParty/SciCustom/css/TableStyle.css" rel="stylesheet" />
<link href="~/ThirdParty/plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet" />

@section InspectionBySP_head{
    <style type="text/css">
        .productTable {
            font-size: 1.4em;
        }

        tr > td {
            vertical-align: middle;
            font-size: 1.2em;
        }
    </style>
}


@Html.Partial("~/Areas/SampleRFT/Views/Shared/_SampleRFTInspection_Layout.cshtml")

<div class="DownWhiteBackgrond">
    @using (Html.BeginForm("BeautifulProductAudit", "InspectionBySP", FormMethod.Post, new { @id = "settingForm", onsubmit = "return checkSubmitValue(this.submitted);" }))
    {
        @Html.HiddenFor(o => o.ID)
        <div style="padding:2em 3em 2em 3em;width:80%;float:left;position: absolute;transform: translate(-50%, 20%);left: 50%">
            <div style="width:100%;margin-bottom:2em">
                <div style="display:inline-block"><h1 style="font-size:2em">Beautiful Product Qty</h1></div>
                <div style="display:inline-block;margin-left:5%">
                    @Html.TextBoxFor(o => o.BAQty, new { @type = "number", @style = "width:80px", @onchange = $"value=QtyCheck(value,{Model.MaxBAQty})"})
                </div>
            </div>
            <div>
                <div><h1 style="font-size:2em;margin-bottom:1em">Non Beautiful Product</h1></div>
                <div style="margin-left:25%">
                    <table class="cell-border productTable" style="width:100%">
                        @for (int i = 0; i < Model.ListBACriteria.Count; i++)
                        {
                            <tr>
                                <td>
                                    @Html.DisplayFor(model => Model.ListBACriteria[i].BACriteria):@Html.DisplayFor(model => Model.ListBACriteria[i].BACriteriaDesc)
                                </td>
                                @if (Model.ListBACriteria[i].Qty == null)
                                {
                                    <td>N/A</td>
                                    <td></td>
                                    <td></td>
                                }
                                else
                                {
                                    <td>
                                        @*@Html.TextBoxFor(model => Model.ListBACriteria[i].Qty, new { @type = "number", @style = "width:80px" })*@

                                        <input type='number' style="width:80px" id='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].Qty' name='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].Qty' class="qty" value='@Model.ListBACriteria[i].Qty'>

                                        <input type='hidden' id='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].Ukey' name='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].Ukey' value='@Model.ListBACriteria[i].Ukey'>

                                        <input type='hidden' id='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].RowIndex' name='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].RowIndex' value='@Model.ListBACriteria[i].RowIndex'>

                                        <input type='hidden' id='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].BACriteria' name='Req.ListBACriteria[@Model.ListBACriteria[i].RowIndex].BACriteria' value='@Model.ListBACriteria[i].BACriteria'>
                                    </td>

                                    <td> <img src="~/Image/Icon/Camera.png" style="cursor: pointer;" onclick="ScreenShot(@Model.ListBACriteria[i].Ukey, '@Model.ListBACriteria[i].BACriteria')" width="30" height="30" /></td>
                                    @*<td><img src="~/Image/Icon/Picture.png" style="cursor: pointer;" onclick="OpenPicture(@Model.ListBACriteria[i].Ukey, @Model.ListBACriteria[i].RowIndex)" width="30" height="30" /></td>*@
                                }
                            </tr>
                        }
                    </table>
                </div>
            </div>
        </div>
        <div style="width:100%">
            <input type="hidden" id="goPage" name="goPage">
            <button id="btnBack" onclick="this.form.submitted=this.value;" type="submit" value="Back" class="button" style="right:7em;">Back</button>
            <button id="btnNext" onclick="this.form.submitted=this.value;" type="submit" value="Next" style="right:0;" class="button">Next</button>
        </div>
    }
</div>

@section InspectionBySP_script
{
    <script>
        var msg = new MessagerAlert();

        $(function () {

            $("#BAQty").change(function () {
                if ($(this).val() == '') {
                    $(this).val(0);
                }
            });
        });

        function QtyCheck(value, Max) {
            if (parseFloat(value) >= Max) {
                return Max;
            }
            else if (parseInt(value) < 0) {
                return 0;
            }

            return Number.parseInt(value);
        }

        function checkSubmitValue(self) {
            document.getElementById("goPage").value = self;

            var qtyDatas = $(".qty");
            var total = 0;

            $.each(qtyDatas, function () {
                total += parseInt($(this).val());
            });
            if (total > @Model.MaxBAQty) {
                msg.WithError("Qty can't greater than @Model.MaxBAQty!!");
                return false;
            }
            else {
                ShowLoading();

                return true;
            }

        }



        function ScreenShot(DetailUkey, BACriteria) {
            window.open('@Url.Action("BAPicture")?ID=@Model.ID&BACriteria=' + BACriteria + '&BAUKey=' + DetailUkey, "Picture", config = 'toolbar=no,status=no,location=no,width=1500,height=1000');
        }

        function GetImage(Data, ImgSource) {
            //透過AJAX暫存成Temp Data

            //根據圖片來源決定存檔方式
            if (ImgSource == 'Camera') {
                var Ukey = Data.DetailUkey;
                var RowIndex = Data.RowIndex;
                var Picture = Data.Img.replace("data:image/png;base64,", "");
                var Remark = Data.Remark;

                var data =
                {
                    Ukey: Ukey,
                    RowIndex: RowIndex,
                    TempImage: Picture,
                    TempRemark: Remark,
                };

                $.ajax({
                    url: "@Url.Action("AddBaPicturesTempSave", "Inspection", new { Area = "FinalInspection" })",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ data: data }),
                    async: true,
                    success: function (data) {
                        //msg.WithSuccess("Image OK!!");
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.responseText);
                    }
                });

            }

            if (ImgSource == 'File') {

                $.ajax({
                    url: "@Url.Action("BatchAddBaPicturesTempSave", "Inspection", new { Area = "FinalInspection" })",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({ list: Data }),
                    async: true,
                    success: function (data) {
                        //msg.WithSuccess("Image OK!!");
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(xhr.responseText);
                    }
                });
            }
        }
    </script>
}