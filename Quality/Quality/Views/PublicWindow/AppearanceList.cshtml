@using DatabaseObject.Public


@{
    Layout = null;
    string TargetID = ViewData["TargetID"] == null ? string.Empty : ViewData["TargetID"].ToString();

}

@model List<Window_Appearance>

<script src="~/Scripts/jquery-3.4.1.min.js"></script>

<link href="~/ThirdParty/plugins/DataTables/datatables.min.css" rel="stylesheet" />
<link href="~/ThirdParty/SciCustom/css/TableStyle.css" rel="stylesheet" />

<script src="~/ThirdParty/plugins/DataTables/datatables.min.js"></script>

<style>

    ul {
        padding: 0;
    }

    li {
        list-style-type: none;
        border: 1px solid black;
        padding: 2px;
    }

    td {
        border-style: ridge;
    }

    .head {
        border-top: 2px solid black;
        text-align: center;
        font-size: 1.2em;
        background-color: lightgray;
    }

    tr:hover {
        background-color: lightblue;
        cursor: pointer;
    }

    tr {
        height: 20px;
    }

    td {
        height: 20px;
    }
</style>

@using (Html.BeginForm("AppearanceList", ViewContext.RouteData.GetRequiredString("Controller"), new { }, FormMethod.Post, new { @width = "100%", @height = "5%", @style = "margin-bottom:10px;" }))
{
    @Html.Hidden("TargetID", TargetID)
    <input id="btnSave" type="button" value="Save" />
    <input id="btnExit" type="button" value="Exit" />
}

<div style="width:45%;height:90%;overflow-y: scroll;float:left;margin-right:2%;">

    <table id="DataListTable" style="width:100%;">
        <thead>
            <tr>
                <td colspan="3" style="text-align:center;font-weight:900;font-size:1.5em">Click to Add</td>
            </tr>
            <tr>
                <td></td>
                <td>ID</td>
                <td>Name</td>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr style="height:2em" class="DataList" AppearanceID="@item.ID" AppearanceName="@item.Name" onclick="DataListClick(this)">
                    <td style="width:20px;"><img src="~/Image/Icon/ChildRowOpen.png" /></td>
                    <td>@item.ID</td>
                    <td>@item.Name</td>
                </tr>

            }
        </tbody>
    </table>
    @*
    *@
</div>
<div style="width:45%;height:90%;overflow-y: scroll;float:left;">

    <table id="PickListTable" style="width:100%;">
        <thead>
            <tr>
                <td colspan="3" style="text-align:center;font-weight:900;font-size:1.5em">Pick List</td>
            </tr>
            <tr>
                <td></td>
                <td>ID</td>
                <td>Name</td>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>


    $(function () {

        $("#btnSave").click(function () {

            var picked = $(".PickList");
            var result = [];
            picked.each(function myfunction() {
                var obj = this;

                var Appearance = {
                    ID: $(obj).attr("appearanceid"),
                    Name: $(obj).attr("appearancename"),
                }
                result.push(Appearance);
            });

            // 呼叫父視窗的 GetAppearance Function，把值傳回去
            window.opener.GetAppearance(result, '@TargetID');
            window.close();
        });

        $("#btnExit").click(function () {
            window.close();
        });
    });

    //右邊Table點選
    function DataListClick(obj) {
        var pick_ID = $(obj).attr("appearanceid");
        var pick_Name = $(obj).attr("appearanceName");

        var newItem = '<tr style="height:2em" class="PickList" AppearanceID="' + pick_ID + '" AppearanceName="' + pick_Name + '" onclick="PickListClick(this)"><td style="width:20px;"><img src="/Image/Icon/ChildRowClose.png" /></td><td>' + pick_ID + '</td><td>' + pick_Name + '</td></tr>';
        $("#PickListTable").append(newItem);
        $(obj).remove();
    };

    //右邊Table點選
    function PickListClick(obj) {
        var pick_ID = $(obj).attr("appearanceid");
        var pick_Name = $(obj).attr("appearanceName");

        var newItem = '<tr style="height:2em" class="DataList" AppearanceID="' + pick_ID + '" AppearanceName="' + pick_Name + '" onclick="DataListClick(this)"><td style="width:20px;"><img src="/Image/Icon/ChildRowOpen.png" /></td><td>' + pick_ID + '</td><td>' + pick_Name + '</td></tr>';

        $("#DataListTable").append(newItem);
        $(obj).remove();
    };

</script>